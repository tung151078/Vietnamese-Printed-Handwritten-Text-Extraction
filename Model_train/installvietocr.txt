Đầu tiên, bạn cần cài đặt thư viện VietOCR và môi trường theo câu lệnh sau:

pip install --quiet vietocr==0.3.2
pip install torch
pip install torchvision

Download pretrain weight tại đây Hoặc sử dụng câu lệnh

gdown https://drive.google.com/uc?id=13327Y1tz1ohsm5YZMyXVMPIOjoOA0OaA

------------------------------------
# Train model

Chọn mô hình là VGG Transformer, tức là mô hình gồm phần backbone là mạng VGG-19 kết hợp với Transformer. Các cấu hình của model sẽ được lưu vào biến config. Lưu ý là các mô hình khác chưa có pretrained weight đâu nhé

from vietocr.tool.config import Cfg
from vietocr.model.trainer import Trainer

config = Cfg.load_config_from_name('vgg_transformer')

Sau đó các bạn chỉnh config phù hợp với bài tóan của mình. Trong đó cần lưu ý :

    data_root : chỉ thư mục cha chứa file có chứa label là train_annotation.txt và test_annotation.txt
    checkpoint: đường dẫn tới file checkpoint mà bạn định lưu
    export: đường dẫn tới pretrained weight
    device: chỉ thiết bị bạn dùng huấn luyện mô hình. Nếu dùng GPU, đặt là cuda:0. Nếu là CPU, đặt là cpu.

dataset_params = {
    'name':'hw',
    'data_root':'./data/',
    'train_annotation':'train_annotation.txt',
    'valid_annotation':'test_annotation.txt'
}

params = {
         'print_every':200,
         'valid_every':15*200,
          'iters':60000,
          'checkpoint':'./checkpoint/transformerocr_checkpoint.pth',    
          'export':'./weights/transformerocr.pth',
          'metrics': 10000,
          'batch_size': 64
         }

params_opt = {
              'init_lr': 0.01,
              'n_warmup_steps': 4000
              }

config['trainer'].update(params)
config['dataset'].update(dataset_params)
config['device'] = 'cuda:0'

Cuối cùng ta tiến hành train và chờ kết quả thôi nào

trainer = Trainer(config, pretrained=True)
trainer.train()

# Test

Sau khi train xong model, bạn sẽ thu được file weight của mô hình. Hoặc bạn nào ngại train thì có thể tại trực tiếp pretrained weight dùng thử vì nó cũng tương đối ngon rồi.

Ảnh đầu vào có tên image.png:

from vietocr.tool.predictor import Predictor
from vietocr.tool.config import Cfg
import cv2

# load pretrained weight
config['weights'] = 'https://drive.google.com/uc?id=13327Y1tz1ohsm5YZMyXVMPIOjoOA0OaA'

# set device to use cpu
config['device'] = 'cpu'
config['cnn']['pretrained']=False
config['predictor']['beamsearch']=False

detector = Predictor(config)
img = cv2.ỉmread('image.png')

# predict
result = detector.predict(img)
print(result)
